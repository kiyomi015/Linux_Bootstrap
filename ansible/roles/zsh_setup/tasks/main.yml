---
- name: Ensure zsh is installed
  ansible.builtin.package:
    name: "{{ zsh_package }}"
    state: present

- name: Resolve zsh path
  ansible.builtin.command: "command -v zsh"
  register: zsh_path
  changed_when: false

- name: Set default shell for bootstrap user
  ansible.builtin.user:
    name: "{{ bootstrap_user }}"
    shell: "{{ zsh_path.stdout }}"
  when:
    - zsh_set_default_shell
    - zsh_path.stdout | length > 0
